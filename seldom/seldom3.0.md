# Seldom3.0: æ”¯æŒAppæµ‹è¯•

å®˜æ–¹æ–‡æ¡£ï¼šhttps://seldomqa.github.io/

## seldom ç‰ˆæœ¬å›é¡¾

2015å¹´7æœˆ15å·æˆ‘åœ¨githubä¸Šæäº¤ä¸€ä¸ªé¡¹ç›®ï¼Œå–åä¸ºï¼špyse = python + seleniumã€‚ é¡¹ç›®éå¸¸ç®€å•æ ¸å¿ƒå°±ä¸‰ä¸ªã€‚

* `pyse.py`ï¼š é’ˆå¯¹ selenium APIåšäº†ç®€å•å°è£…ã€‚
* `HTMLTestRunner.py`: ä¿®æ”¹çš„HTMLTestRunneræŠ¥å‘Šã€‚
* `TestRunner.py`: ä¸€ä¸ªç®€å•çš„ unittestè¿è¡Œå™¨ã€‚

ä¹‹åé¡¹ç›®æ–­æ–­ç»­ç»­çš„åœ¨ç»´æŠ¤ï¼Œç›´åˆ°2019å¹´ï¼Œä¹Ÿè®¸æ˜¯å¤ªé—²äº†ï¼ŒåŠ ä¸Šå¯¹UIè‡ªåŠ¨åŒ–æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œé‡æ–°æŠ•å…¥ä¸»è¦ç²¾åŠ›ç»´æŠ¤pyseé¡¹ç›®ã€‚

åæ¥å°±éœ€è¦å°†æäº¤åˆ°pypiï¼Œè¿™æ ·æ›´æ–¹ä¾¿é€šè¿‡`pip`å®‰è£…ï¼Œå‘ç° pyse å·²ç»è¢«å ç”¨äº†ï¼Œåæ¥æ›´åä¸º`seldom`ï¼Œå…¶å®å‘½åæ²¡æœ‰å¤ªå¤šå¯“æ„ï¼Œå°±æ˜¯çœ‹ä»–é•¿å¾—å’Œ`selenium`æ¯”è¾ƒæ¥è¿‘ã€‚


2020å¹´1æœˆå‘å¸ƒ1.0ç‰ˆæœ¬ï¼Œä¹‹æ‰€ä»¥å‘å¸ƒ1.0 æ˜¯å› ä¸ºè‡ªè®¤ä¸ºæ¡†æ¶çš„åŠŸèƒ½æ¯”è¾ƒæˆç†Ÿäº†ï¼Œå¹¶ä¸”èŠ±è´¹æ—¶é—´è¡¥å……äº†æ–‡æ¡£ã€‚å¤§å®¶éƒ½ä¸é‡è§†æ–‡æ¡£ï¼Œå…¶å®æ–‡æ¡£éå¸¸é‡è¦ï¼Œä¹Ÿéœ€è¦èŠ±å¤§é‡çš„æ—¶é—´ç¼–å†™å’Œç»´æŠ¤ã€‚æœ‰æ—¶é—´ä½ åŠ ä¸ªåŠŸèƒ½å¾ˆç®€å•ï¼Œç¼–å†™è¯´æ˜æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹å°±è¦èŠ±è´¹ç­‰åŒçš„æ—¶é—´ã€‚

1.0 ç‰ˆæœ¬ä¹‹åï¼Œé¡¹ç›®æ ¸å¿ƒå›´ç»•ç€ selenium APIçš„å°è£… å’Œ unittestæ¡†æ¶æ‰©å±•ï¼ˆseldomåŸºäºunittestï¼‰ç­‰ã€‚

2021å¹´4æœˆæ­£å¼å‘å¸ƒ 2.0ï¼Œé›†æˆrequests, æ­£å¼æ”¯æŒhttpæ¥å£æµ‹è¯•ã€‚èµ·å› æ˜¯å‘ç°cypressæ”¯æŒhttpè°ƒç”¨ï¼Œå“¦ï¼ŒåŸæ¥UIæµ‹è¯•å·¥å…·ä¹Ÿå¯ä»¥å»åšæ¥å£ï¼Œæ ¼å±€ä¸€ä¸‹å­æ‰“å¼€äº†ï¼å¦‚ä½•åœ¨ä¸å½±å“ç°æœ‰selenium APIçš„æƒ…å†µä¸‹é›†æˆrequestsæ˜¯2.0è€ƒè™‘çš„é‡ç‚¹ã€‚

2022å¹´1æœˆseldomé¡¹ç›®æ­£å¼åœ¨å…¬å¸å†…éƒ¨æ¨å¹¿ä½¿ç”¨ï¼Œå½“æ—¶æˆ‘ä»¬åšäº†å‡ ç‰ˆçš„æ¥å£æµ‹è¯•å¹³å°ï¼Œå¹³å°çš„å¼€å‘ç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¯¹äºå¤æ‚çš„åœºæ™¯ç”¨ä¾‹ï¼Œç¼–å†™æˆæœ¬ä¸æ¯”æ¡†æ¶ç®€å•ï¼›æµ‹è¯•äººå‘˜ä¹Ÿè‹¦å¹³å°ä¹…å·²ï¼ˆå°ç™½å½“ç„¶å–œæ¬¢å¹³å°ï¼Œæ‡‚ç‚¹å„¿ç¼–ç¨‹å¾—æµ‹è¯•ï¼Œéƒ½ä¸å¤ªæ„¿æ„è¢«å¹³å°æŸç¼šï¼‰ã€‚

å› ä¸ºåœ¨å…¬å¸å¾—åˆ°æ¨å¹¿ä½¿ç”¨ï¼Œseldom æ˜æ˜¾è¿›å…¥äº†æ›´åŠ å¿«é€Ÿçš„è¿­ä»£å¼€å‘é˜¶æ®µã€‚

## seldom 3.0 èƒŒæ™¯

seldomé›†æˆAppæµ‹è¯•æ˜¯é¡ºç†æˆç« çš„äº‹æƒ…ï¼Œæ—©åœ¨å‡ ä¸ªæœˆå‰æˆ‘å·²ç»åœ¨å…¬å¸é¡¹ç›®ä¸­å°è¯• seldom + appium è¿›è¡ŒAppè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚Appè‡ªåŠ¨åŒ–çš„ç»´æŠ¤æˆæœ¬ç¡®å®æ¯”æ¥å£è¦é«˜è®¸å¤šï¼Œè¿™æ˜¯ç”±Appæœ¬èº«çš„ç‰¹ç‚¹å†³å®šçš„ï¼Œæ¡†æ¶å¾ˆéš¾åšåˆ°å®è´¨ä¸Šçš„æ”¹å˜ã€‚

2020å¹´10æœˆseldom 3.0 betaå‘å¸ƒï¼Œä¹‹æ‰€ä»¥é€‰æ‹©appiumæœ‰å‡ ä¸ªåŸå› ï¼š

1. appium æ˜¯ç”±å•†ä¸šå·¥å…·åœ¨ç»´æŠ¤ï¼Œå†å²æ¯”è¾ƒé•¿ï¼Œä¸ä¼šéšæ„åœæ­¢ç»´æŠ¤ã€‚
2. appium åº”ç”¨æ›´åŠ å¹¿æ³›ï¼Œä½¿ç”¨å¾—äººæ›´å¤šï¼Œæ”¯æŒå¾—å¹³å°å¤šï¼ˆandroid/ios/flutterï¼‰
3. appium ç»§æ‰¿seleniumï¼Œå¯¹äºseldomæ¥è¯´å¯¹åŸæœ‰APIæ”¹åŠ¨æœ€å°ã€‚

> æ³¨ï¼šç›®å‰åˆšåˆšå‘å¸ƒ seldom beta2 ç‰ˆæœ¬ã€‚

## seldom ç®€å•ç¤ºä¾‹

å¦‚æœä½ ç†Ÿæ‚‰appium è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒï¼Œé‚£ä¹ˆä½¿ç”¨seldom å‡ ä¹ä¸éœ€è¦å­¦ä¹ æˆæœ¬ï¼Œä»–åªæ˜¯å¯¹`Appium-Python-Client` çš„APIåšäº†ç®€å•çš„å°è£…ã€‚

ç®€å•ç¤ºä¾‹ï¼š

```py
# test_app.py
import seldom

class TestBBS(seldom.TestCase):

    def test_bbs_search(self):
        """BBSæœç´¢æµ‹è¯• """
        self.click(id_="com.meizu.flyme.flymebbs:id/nw")
        self.type(id_="com.meizu.flyme.flymebbs:id/nw", text="flyme")
        self.click(id_="com.meizu.flyme.flymebbs:id/o1")
        self.sleep(2)
        elems = self.get_elements(id_="com.meizu.flyme.flymebbs:id/a29")
        for title in elems:
            self.assertIn("lyme", title.text)


if __name__ == '__main__':
    desired_caps = {
        'deviceName': 'JEF_AN20',
        'automationName': 'UiAutomator2',
        'platformName': 'Android',
        'platformVersion': '10.0',
        'appPackage': 'com.meizu.flyme.flymebbs',
        'appActivity': '.ui.LoadingActivity',
        'noReset': True,
    }
    seldom.main(app_info=desired_caps, app_server="http://127.0.0.1:4723")
```

è¿è¡Œæ—¥å¿—ï¼š

```shell
> python .\test_app.py

              __    __
   ________  / /___/ /___  ____ ____
  / ___/ _ \/ / __  / __ \/ __ ` ___/
 (__  )  __/ / /_/ / /_/ / / / / / /
/____/\___/_/\__,_/\____/_/ /_/ /_/  v3.0.0beta1
-----------------------------------------
                             @itest.info


XTestRunner Running tests...

----------------------------------------------------------------------
2022-10-03 00:01:30 webdriver.py | INFO | ğŸ’¤ï¸ sleep: 5s.
2022-10-03 00:01:35 webdriver.py | INFO | âœ… Find 1 element: id=com.meizu.flyme.flymebbs:id/nw  -> click.
2022-10-03 00:01:36 webdriver.py | INFO | âœ… Find 1 element: id=com.meizu.flyme.flymebbs:id/nw  -> input 'flyme'.
2022-10-03 00:01:37 webdriver.py | INFO | âœ… Find 1 element: id=com.meizu.flyme.flymebbs:id/o1  -> click.
2022-10-03 00:01:37 webdriver.py | INFO | ğŸ’¤ï¸ sleep: 2s.
2022-10-03 00:01:39 webdriver.py | INFO | âœ… Find 5 element: id=com.meizu.flyme.flymebbs:id/a29 .
flymeçš„å±å¹•è‰²å½©æ˜¾ç¤ºåº”è¯¥æ˜¯æ¯”è¾ƒå·®çš„

é­…æ—17çš„Flyme9çŠ¶æ€æ ä¸‹æ‹‰é—®é¢˜ã€‚

flyme9.3è¿ä¸Šè€³æœºæ¥ç”µè¯è¿˜æ˜¯ä¼šå¤–æ”¾

flymeè‡ªå¸¦å½•å±åŠŸèƒ½å—ï¼Ÿ

å…³äºFlyme 8.18.0Aç¨³å®šç‰ˆ


Generating HTML reports...
.12022-10-03 00:01:40 runner.py | SUCCESS | generated html file: file:///D:\github\seldom\reports\2022_10_03_00_01_23_result.html
2022-10-03 00:01:40 runner.py | SUCCESS | generated log file: file:///D:\github\seldom\reports\seldom_log.log
```

## AppiumLab ç±»

Labå³å®éªŒå®¤çš„æ„æ€ï¼Œåœ¨`AppiumLab` ç±»ä¸­å¯¹ appium çš„ä¸€äº›APIåšäº†äºŒæ¬¡å°è£…ã€‚


* __Action__

Actionä¸­æä¾›åŸºæœ¬æ»‘åŠ¨/è§¦æ‘¸æ“ä½œã€‚

```py
from seldom.appium_lab import AppiumLab

appium_lab = AppiumLab(self.driver)
# è§¦æ‘¸åæ ‡ä½
appium_lab.tap(x=100, y=200)
# ä¸Šåˆ’
appium_lab.swipe_up()
# ä¸‹åˆ’
appium_lab.swipe_down()
```

* __Switch__

Switchä¸­æä¾›åŸºæœ¬ä¸Šä¸‹æ–‡åˆ‡æ¢æ“ä½œã€‚
```python
from seldom.appium_lab import AppiumLab

appium_lab = AppiumLab(self.driver)

# åˆ‡æ¢åŸç”Ÿapp
appium_lab.switch_to_app()
# åˆ‡æ¢webview
appium_lab.switch_to_web()
# åˆ‡æ¢flutter
appium_lab.switch_to_flutter()
```

*  __Find__

Findä¸­æä¾›åŸºäºæ–‡æœ¬çš„æŸ¥æ‰¾ï¼Œä¸€ä¸ªå…ƒç´ å¯ä»¥æ²¡æœ‰IDã€nameï¼Œä½†ä¸€å®šæœ‰æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œè¿™é‡Œæä¾›äº†ä¸€ç»„åŸºäºæ–‡æœ¬çš„æŸ¥æ‰¾ã€‚
```python
from seldom.appium_lab import AppiumLab

appium_lab = AppiumLab(self.driver)

# Android
appium_lab.find_view(text="xxxæ ‡é¢˜").click()
appium_lab.find_view(content_desc="xxxæ ‡é¢˜").click()
appium_lab.find_edit_text(text="xxxæ ‡é¢˜").click()
appium_lab.find_button(text="xxxæ ‡é¢˜").click()
appium_lab.find_button(content_desc="xxxæ ‡é¢˜").click()
appium_lab.find_text_view(text="xxxæ ‡é¢˜").click()
appium_lab.find_image_view(text="xxxæ ‡é¢˜").click()
appium_lab.find_check_box(text="xxxæ ‡é¢˜").click()

# iOS
appium_lab.find_static_text(text="xxxæ ‡é¢˜").click()
appium_lab.find_other(text="xxxæ ‡é¢˜").click()
appium_lab.find_text_field(text="xxxæ ‡é¢˜").click()
appium_lab.find_image(text="xxxæ ‡é¢˜").click()
appium_lab.find_ios_button(text="xxxæ ‡é¢˜").click()
```

* __keyboard__

keyboardä¸­æä¾›åŸºäºé”®ç›˜çš„è¾“å…¥å’Œæ“ä½œã€‚
```
from seldom.appium_lab import AppiumLab

appium_lab = AppiumLab(self.driver)

# åŸºäºé”®ç›˜è¾“å…¥ï¼ˆæ”¯æŒå¤§å°å†™ï¼‰
appium_lab.key_text("Hello123")
# æ‰‹æœºhomeé”®
appium_lab.home()
# æ‰‹æœºè¿”å›é”®
appium_lab.back()
# åˆ¤æ–­å½“å‰è™šæ‹Ÿé”®ç›˜æ˜¯å¦æ˜¾ç¤ºï¼ˆTrue/Falseï¼‰
ret = appium_lab.is_keyboard_shown()
print(ret)
# æ”¶èµ·è™šæ‹Ÿé”®ç›˜
appium_lab.hide_keyboard()
```

## Page Objectè®¾è®¡æ¨¡å¼

åœ¨ç¼–å†™Appè‡ªåŠ¨åŒ–æµ‹è¯•æ—¶ï¼Œæ¨èä½¿ç”¨page object models(ç®€ç§° POè®¾è®¡æ¨¡å¼)ã€‚ä½ å¯ä»¥çœ‹åˆ°seldomå¹¶æ²¡æœ‰å®Œå…¨å°è£…appiumçš„APIï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© poium æ¥å®ç°åŸºäºå…ƒç´ çš„å®šä½ã€‚

github: https://github.com/SeldomQA/poium

* å®‰è£…poium

```shell
> pip install poium
```

* ä½¿ç”¨poium

åœ¨seldomä¸­åŸºäºpoiumå®ç°å…ƒç´ çš„å®šä½å’Œæ“ä½œã€‚

```py
import seldom
from poium import Page, Element, Elements


class BBSPage(Page):
    search_input = Element(id_="com.meizu.flyme.flymebbs:id/nw")
    search_button = Element(id_="com.meizu.flyme.flymebbs:id/o1")
    search_result = Elements(id_="com.meizu.flyme.flymebbs:id/a29")


class TestBBS(seldom.TestCase):

    def start(self):
        self.bbs_page = BBSPage(self.driver)

    def test_bbs(self):
        # å®šä¹‰è¿è¡Œç¯å¢ƒ
        self.sleep(5)
        self.bbs_page.search_input.click()
        self.bbs_page.search_input.send_keys("flyme")
        self.bbs_page.search_button.click()
        elems = self.bbs_page.search_result
        for title in elems:
            print(title.text)
            self.assertIn("flyme", title.text.lower())
```

__å®šä½æ–¹æ³•__

poium æ”¯æŒçš„å®šä½æ–¹æ³•ã€‚

```py
# selenium
css = "xx"
id_ = "xx"
name = "xx"
xpath = "xx"
link_text = "xx"
partial_link_text = "xx"
tag = "xx"
class_name = "xx"

# appium
ios_uiautomation = "xx"
ios_predicate = "xx"
ios_class_chain = "xx"
android_uiautomator = "xx"
android_viewtag = "xx"
android_data_matcher = "xx"
android_view_matcher = "xx"
windows_uiautomation = "xx"
accessibility_id = "xx"
image = "xx"
custom = "xx"
```

__Elementç±»å‚æ•°__

* timeout: è®¾ç½®è¶…æ—¶æ£€æŸ¥æ¬¡æ•°ï¼Œé»˜è®¤ä¸º5ã€‚
* index: è®¾ç½®å…ƒç´ ç´¢å¼•ï¼Œå½“ä½ çš„å®šä½æ–¹å¼é»˜è®¤åŒ¹é…åˆ°å¤šä¸ªå…ƒç´ æ—¶ï¼Œé»˜è®¤è¿”å›ç¬¬1ä¸ªï¼Œå³ä¸º0.
* describe: è®¾ç½®å…ƒç´ æè¿°ï¼Œé»˜è®¤ä¸ºundefined, å»ºè®®ä¸ºæ¯ä¸ªå…ƒç´ å¢åŠ æè¿°ã€‚
